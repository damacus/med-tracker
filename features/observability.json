[
  {"id": "OTEL-001", "category": "functional", "area": "observability", "description": "OpenTelemetry SDK initialized on application boot", "steps": ["Start Rails application", "Check logs for OpenTelemetry initialization", "Verify SDK configured with service name 'medtracker'", "Verify resource attributes set correctly"], "passes": false},
  {"id": "OTEL-002", "category": "functional", "area": "observability", "description": "HTTP requests generate traces", "steps": ["Configure OTLP exporter", "Make HTTP request to /dashboard", "Verify trace created with correct span name", "Verify HTTP method and status code attributes", "Verify trace_id propagated in response headers"], "passes": false},
  {"id": "OTEL-003", "category": "functional", "area": "observability", "description": "Database queries generate spans", "steps": ["Enable ActiveRecord instrumentation", "Make request that queries database", "Verify db.system attribute set to postgresql", "Verify db.statement contains SQL query", "Verify span is child of HTTP request span"], "passes": false},
  {"id": "OTEL-004", "category": "functional", "area": "observability", "description": "Custom spans for medication recording", "steps": ["Instrument MedicationTake creation", "Record a medication dose", "Verify custom span created", "Verify span includes prescription_id or person_medicine_id", "Verify span includes user_id who administered"], "passes": false},
  {"id": "OTEL-005", "category": "functional", "area": "observability", "description": "Error traces capture exceptions", "steps": ["Trigger an application error", "Verify exception recorded in span", "Verify exception.type attribute set", "Verify exception.message attribute set", "Verify exception.stacktrace attribute set", "Verify span status set to ERROR"], "passes": false},
  {"id": "OTEL-006", "category": "functional", "area": "observability", "description": "Trace context propagation across services", "steps": ["Configure W3C trace context propagator", "Make request with traceparent header", "Verify incoming trace context honored", "Verify child spans use parent trace_id", "Verify outgoing requests include traceparent"], "passes": false},
  {"id": "OTEL-007", "category": "functional", "area": "observability", "description": "Metrics for HTTP request duration", "steps": ["Enable metrics instrumentation", "Make multiple HTTP requests", "Verify http.server.duration histogram recorded", "Verify metrics include route and status_code labels", "Verify percentiles calculated correctly"], "passes": false},
  {"id": "OTEL-008", "category": "functional", "area": "observability", "description": "Metrics for database connection pool", "steps": ["Enable ActiveRecord metrics", "Query database under load", "Verify db.pool.size gauge recorded", "Verify db.pool.used gauge recorded", "Verify db.pool.waiting gauge recorded"], "passes": false},
  {"id": "OTEL-009", "category": "functional", "area": "observability", "description": "Custom metrics for medication takes", "steps": ["Create custom counter for medication_takes_total", "Record multiple medication doses", "Verify counter incremented", "Verify labels include medicine_type (prescription/otc)", "Verify labels include user_role"], "passes": false},
  {"id": "OTEL-010", "category": "functional", "area": "observability", "description": "Structured logging with trace correlation", "steps": ["Configure Rails logger with OpenTelemetry", "Make HTTP request", "Check application logs", "Verify trace_id in log entries", "Verify span_id in log entries", "Verify logs can be correlated with traces"], "passes": false},
  {"id": "OTEL-011", "category": "functional", "area": "observability", "description": "OTLP exporter configuration", "steps": ["Set OTEL_EXPORTER_OTLP_ENDPOINT environment variable", "Set OTEL_EXPORTER_OTLP_HEADERS for authentication", "Start application", "Verify traces exported to configured endpoint", "Verify metrics exported to configured endpoint"], "passes": false},
  {"id": "OTEL-012", "category": "functional", "area": "observability", "description": "Sampling configuration for production", "steps": ["Configure trace sampling rate via OTEL_TRACES_SAMPLER", "Set sampling rate to 10%", "Make 100 requests", "Verify approximately 10 traces exported", "Verify parent-based sampling respects incoming decisions"], "passes": false},
  {"id": "OTEL-013", "category": "functional", "area": "observability", "description": "Health check endpoint excluded from tracing", "steps": ["Configure span filter for health checks", "Make request to /health or /up", "Verify no trace created for health check", "Make request to /dashboard", "Verify trace created for normal request"], "passes": false},
  {"id": "OTEL-014", "category": "functional", "area": "observability", "description": "Sensitive data scrubbed from traces", "steps": ["Make login request with password", "Verify password not in span attributes", "Make request with authorization header", "Verify auth token not in span attributes", "Verify email addresses optionally redacted"], "passes": false},
  {"id": "OTEL-015", "category": "functional", "area": "observability", "description": "Background job tracing with Solid Queue", "steps": ["Enable Solid Queue instrumentation", "Enqueue a background job", "Verify span created for job enqueue", "Verify span created for job execution", "Verify job spans linked to originating request trace"], "passes": false},
  {"id": "OTEL-016", "category": "functional", "area": "observability", "description": "Complete observability stack integration test", "steps": ["Start application with OpenTelemetry configured", "Configure OTLP exporter to local collector", "Log in as administrator", "Navigate to dashboard", "Create a new user", "Record a medication dose", "Verify all operations traced", "Verify traces visible in collector", "Verify metrics exported", "Verify logs correlated with traces", "Verify no sensitive data exposed"], "passes": false}
]
