Preparing database...

Components::Admin::AuditLogs::IndexView
  initialization
    accepts versions and filter_params
    defaults filter_params to empty hash
  #filters_active?
    when no filters are set
      returns false
    when item_type filter is set
      returns true
    when event filter is set
      returns true
  #total_pages
    returns 1 when total_count is 0
    returns 1 when total_count is less than per_page
    returns correct number of pages when total_count exceeds per_page
    returns 1 when total_count equals per_page
  #first_item_number
    returns 1 when on page 1
    returns 51 when on page 2
  #last_item_number
    returns total_count when on last page with partial results
    returns per_page when on full page
  #pagination_url
    generates URL with page parameter
    preserves filter parameters

Components::Admin::AuditLogs::ShowView
  initialization
    accepts a version
  helper methods
    #user_name
      returns the user name when whodunnit is present
      returns System when whodunnit is blank
      returns User #ID when user is not found
    #format_object
      formats YAML object as JSON
      returns original string on parse error
    #filter_sensitive_fields
      removes password_digest from data
      removes password_hash from data
      returns non-hash data unchanged
    #description_for_new_state
      returns create description for create events
      returns update description for update events
    #compute_new_state
      returns the next version object when there is a next version
      returns the current record attributes when there is no next version
    #format_new_state
      formats YAML string as JSON
      formats Hash as JSON
      converts other types to string

Components::Admin::Users::Pagination
  pagination info
    renders the result count information
    renders the from and to range
  navigation
    renders page number links
    disables previous button on first page
    enables next button when there is a next page
  mobile pagination
    renders previous and next buttons for mobile
  when on the last page
    disables next button on last page
    enables previous button
  when there is only one page
    does not render the pagination nav
  search params preservation
    includes search params in page links
  accessibility
    renders pagination nav with aria-label
    renders sr-only text for previous and next buttons

Components::Admin::Users::SearchForm
  rendering without errors
    renders the search form with default params
    renders role and status select elements using select_classes from FormHelpers
  search field
    renders a text input for search
    populates the search field with existing params
  role filter
    renders all user roles as options
    pre-selects the current role filter
  status filter
    renders active and inactive status options
    pre-selects the current status filter
  actions
    renders a search button
    renders a clear link when filters are active
    does not render a clear link when no filters are active
  accessibility
    renders labels for all form fields
    associates labels with their inputs via matching ids

Components::Admin::Users::UsersTable
  rendering
    renders a table
    renders table headers
    renders a row for each user
  sortable headers
    renders sortable links for Name, Email, and Role
    includes sort direction in header links
    renders sort indicator for active sort column
    renders descending indicator when direction is desc
  with empty user list
    renders the table with no body rows

Components::Dashboard::DeleteConfirmationDialog
  i18n translations
    renders delete dialog with default locale translations

Components::Dashboard::DeleteConfirmationDialog
  rendering
    renders a delete trigger button
    renders the confirmation dialog content
    includes the medicine name in the confirmation message
    includes the person name in the confirmation message
  dialog actions
    renders a cancel button
    renders a delete confirmation form with DELETE method
    renders a destructive confirm button
  trigger button
    renders with a test id based on prescription id
    applies custom button_class when provided

Components::Dashboard::IndexView
  renders the dashboard title
  renders the schedule heading
  stats display
    renders people count
    renders active prescriptions count
  quick actions
    renders Add Medicine and Add Person links
  high-fidelity sections
    renders Smart Insights
    renders Stock Inventory
  when there are no active prescriptions or person medicines
    renders the empty state message

Components::Dashboard::PersonSchedule
  renders the person's name
  renders each prescription
  renders take now links for each prescription

Components::Dashboard::PrescriptionCard
  rendering
    renders the person name
    renders the medicine name
    renders the prescription frequency
    renders the medicine quantity
  card structure
    renders with a prescription-specific id
    renders dosage details
    renders end date information

Components::Dashboard::PrescriptionHelpers
  #format_dosage
    when dosage has amount and unit
      formats integer amounts without decimal
      formats decimal amounts with decimal
    when dosage is missing amount
      returns em dash
    when dosage is missing unit
      returns em dash
    when dosage is nil
      returns em dash
  #format_quantity
    when medicine has stock
      returns the stock as a string
    when medicine stock is nil
      returns em dash
    when medicine is nil
      returns em dash
  #format_end_date
    when prescription has end_date
      formats the date
    when prescription has no end_date
      returns em dash
  #can_delete?
    when current_user is nil
      returns false
    when current_user is present
      delegates to PrescriptionPolicy
      returns false when policy denies destroy

Components::Dashboard::PrescriptionRow
  renders the medicine quantity

Components::Dashboard::QuickActions
  i18n translations
    renders quick actions with default locale translations

Components::Dashboard::QuickActions
  renders heading and action links using Link component

Components::Dashboard::StatCard
  rendering
    renders the title
    renders the value
    renders a users icon when icon_type is users
    renders a pill icon when icon_type is pill
  structure
    renders within a card component
    renders the title

Components::Dashboard::TimelineItem
  renders the medicine name and person name
  renders the correct status badge
  renders a success badge when taken
  shows only the person name for upcoming doses

Components::Layouts::AuthLayout
  does not render global flash messages (auth views handle flash inline)

Components::Layouts::BottomNav
  renders navigation links with 44px minimum touch targets

Components::Layouts::Flash
  renders flash container above navigation
  notice flash
    renders the notice message directly without redundant title
    renders the success icon
  warning flash
    renders the warning message with warning variant (amber styling)
    renders the warning icon
  alert flash
    renders the alert message directly without redundant title
    renders the alert icon

Components::Layouts::MobileMenu
  i18n translations
    renders mobile menu with default locale translations

Components::Layouts::MobileMenu
  rendering
    renders within a mobile-only container
    renders a hamburger menu trigger
  navigation links
    renders Inventory link
    renders People link
    renders Medicine Finder link
  auth actions
    renders Profile link
    renders Logout button
    renders Administration link for admin users
    does not render Administration link for non-admin users
  accessibility
    renders hamburger button with aria-label
    renders close button with aria-label
    renders close button with 44px minimum touch target
    renders sr-only text for close button
  keyboard navigation
    renders close button with focus ring styles

Components::Layouts::Navigation
  i18n translations
    renders navigation with default locale translations

Components::Layouts::ProfileMenu
  rendering
    renders a dropdown menu
    renders My Account label
  menu items
    renders Dashboard link
    renders Profile link
    renders Logout link
  admin menu item
    renders Administration link for admin users
    does not render Administration link for non-admin users
  without current_user
    renders Account as fallback name

Components::Layouts::Sidebar
  when user is authenticated
    renders the brand name
    renders navigation links
    renders the user profile section
    renders the sign out button
  when user is not authenticated
    renders nothing

Components::Medicines::FormView
  i18n translations
    renders form with default locale translations

Components::Medicines::ShowView
  renders the medicine name
  renders action links using Link component without raw button classes
  renders the inventory status heading
  renders safety warnings when present

Components::People::PersonCard
  renders Needs Carer badge using RubyUI::Badge component (not inline styles)

Components::People::ShowView
  renders the person name and type
  renders the Profile Overview card
  renders the Care Actions card
  renders prescriptions and my medicines sections

Components::PersonMedicines::Card
  countdown notice styling
    uses amber/warning styling distinct from notes

Components::PersonMedicines::Card
  pre-loaded todays_takes
    displays takes from pre-loaded collection
    shows no doses message when pre-loaded takes is empty
    falls back to querying when todays_takes is not provided

Components::PersonMedicines::FormView
  i18n translations
    renders form with default locale translations

Components::Prescriptions::Card
  i18n translations
    renders card with default locale translations
    renders delete dialog with translated strings for admin user

Components::Prescriptions::Card
  displays dosage unit from prescription, not hardcoded ml

Components::Prescriptions::Card
  pre-loaded todays_takes
    displays takes from pre-loaded collection
    shows no doses message when pre-loaded takes is empty
    falls back to querying when todays_takes is not provided

RubyUI::Alert
  renders with role alert
  renders destructive variant with semantic classes
  renders warning variant with semantic classes
  renders success variant with semantic classes
  merges custom classes

RubyUI::Badge
  renders with primary variant by default
  WCAG 2.2 SC 2.5.8 minimum target size
    includes min-h-[24px] and min-w-[24px] for :sm size
    includes min-h-[24px] and min-w-[24px] for :md size
    includes min-h-[24px] and min-w-[24px] for :lg size

RubyUI::BreadcrumbEllipsis
  renders a more-horizontal icon by default
  yields a custom block if provided (FAILED - 1)

RubyUI::BreadcrumbItem
  renders an inline list item (FAILED - 2)

RubyUI::BreadcrumbLink
  renders an anchor tag (FAILED - 3)

RubyUI::BreadcrumbPage
  renders a span with current=page aria attribute (FAILED - 4)

RubyUI::BreadcrumbSeparator
  renders a chevron right icon by default
  yields a custom block if provided

RubyUI::Breadcrumbs
  renders a navigation with breadcrumb aria-label

RubyUI::Button
  renders a button element
  renders primary variant by default
  renders destructive variant with filled background
  renders outline variant with border
  renders destructive_outline variant with border and semantic destructive text
  renders success_outline variant with border and semantic success text
  merges custom classes

Components::Shared::StockBadge
  #view_template
    when medicine has no current_supply value
      renders nothing
    when medicine is in stock
      renders the supply count
    when medicine is low stock
      renders Low Stock badge with count
    when medicine is out of stock
      renders Out of Stock badge with count

Views::Rodauth::Login
  renders the login form
  renders flash message inline near the login form (proximity principle)

Views::Rodauth::OtpAuth
  renders the OTP authentication form

Views::Rodauth::OtpDisable
  renders the OTP disable form

Views::Rodauth::TwoFactorAuth
  renders the two-factor auth selection screen

Views::Rodauth::WebauthnAuth
  renders the WebAuthn authentication form

Heading Order Accessibility
  Dashboard page
    has proper heading hierarchy
    does not skip from h1 to h3
  Admin Dashboard page
    has proper heading hierarchy
    does not skip from h1 to h3
  Medicines index page
    has proper heading hierarchy
  People index page
    has proper heading hierarchy
  Admin Users index page
    has proper heading hierarchy

Admin Audit Logs
  access control
    allows administrators to view audit logs
    denies access to non-administrators
    redirects unauthenticated users to login
  navigation
    shows audit trail link on admin dashboard
  audit log list
    displays the audit log page with headers
    shows filter form with dropdowns
  filtering
    has filter form with Stimulus controller
    has dropdowns with auto-submit actions
    shows clear link when visiting with filter params
  audit log details
    shows detail page when clicking View link
  complete audit trail review workflow (AUDIT-013)
    displays list of audit entries with required columns
    shows detailed view with previous and new state
    allows navigation back to list
    filters by record type and shows only matching entries
    filters by event type and shows only matching entries
    clears all filters and shows all entries again
  medication take lifecycle audit (AUDIT-014)
    logs medication take creation with all required fields
    records IP address for medication takes
  pagination
    shows pagination controls when there are many entries
    navigates between pages

Admin User Edit Button
  navigates to edit page when Edit button is clicked
  Edit button is accessible and has proper styling

Admin User Management Workflow
  completes full user lifecycle from creation to activation

Invite-only sign-up
  when an administrator exists
    redirects to login when visiting create-account without an invitation token
    does not show the Create Account link on the login page
    allows visiting create-account with a valid invitation token
  when no administrator exists
    allows visiting create-account without an invitation token
    shows the Create Account link on the login page

AUTH: OmniAuth Auto Linking
  auto-links an existing account based on email when logging in via OmniAuth (PENDING: OIDC not configured)

PASSKEY-002: Passkey registration
  Passkey management section on profile page
    User with no passkeys sees empty state
    User with passkeys sees list of registered passkeys
    User can navigate to add passkey page
    User sees remove button for registered passkeys

PASSKEY-001: WebAuthn/Passkey configuration
  WebAuthn key timestamps default to current timestamp
  WebAuthn gem is available
  WebAuthn database tables exist
  WebAuthn models are defined
  Account model has WebAuthn associations
  Rodauth WebAuthn feature is enabled

Authentication Features
  AUTH-019: Additional factor required for 2FA accounts
    redirects to TOTP authentication after password login
  AUTH-007: Email verification grace period configuration
    has environment-aware grace period configuration
  AUTH-014: Password reset flow
    allows user to request password reset
    shows error for non-existent email
  AUTH-015: Remember me functionality
    shows remember me checkbox on login form
    creates remember key when remember me is checked
  AUTH-016: Account status unverified prevents login in production
    has environment-aware grace period configuration
    allows unverified accounts to login during grace period in non-production
  AUTH-017: Account status closed prevents login
    prevents login for closed accounts
  AUTH-018: Verification email resend
    shows resend verification link on login page
    allows requesting verification email resend
  AUTH-009/010: OIDC configuration
    has omniauth feature enabled in Rodauth configuration
    has account_identities table for storing OIDC identities
    shows login page with OIDC section or other options
  AUTH-013: Link OIDC account from settings
    has omniauth configuration in Rodauth

CSP Compliance
  inline styles
    does not use inline styles in RubyUI components

Dashboard Authorization
  viewing the dashboard
    when signed in as an administrator
      sees all people and prescriptions
    when signed in as a doctor
      sees all people and prescriptions
    when signed in as a nurse
      sees all people and prescriptions
    when signed in as a carer
      sees only assigned patients
      sees only prescriptions for assigned patients
    when signed in as a parent
      sees only their minor children
      sees only prescriptions for their children
    when signed in as an adult patient
      sees only themselves
      sees only their own prescriptions

Medicine Lookup
  User searches for a medicine and sees results
  Search returns no results
  API unavailable shows error message
  User views drug interactions (not yet implemented) (PENDING: MLKP-015: drug interaction lookup not yet implemented)

Medicine Stock Tracking
  displays current stock on the dashboard
  shows low stock badge when stock reaches threshold
  shows out of stock badge when stock is zero
  disables the Take Now button when out of stock
  deducts stock when taking a dose

OTEL-011: OTLP exporter configuration
  when configuring the OpenTelemetry SDK
    configures OpenTelemetry with service name medtracker-test
    sets resource attributes correctly
    enables Rails instrumentation
    enables ActiveRecord instrumentation
    enables Rack instrumentation with untraced endpoints
    uses W3C TraceContext propagator
  when parsing OTLP headers
    parses headers string correctly
    handles empty headers string
    handles nil headers string
    handles malformed headers gracefully

Person Medicines
  adding a non-prescription medicine
    allows adding a vitamin/OTC medicine without a prescription
  recording medicine takes
    allows recording a medicine take
    disables the take button when max daily doses reached
    disables the take button when minimum hours not passed
  viewing today's doses on card
    displays today's doses on the medicine card

Prescription Card
  Card Display
    displays medicine name and icon
    displays dosage information
    does not display stock badge when adequately stocked
    displays start date
    displays end date when present
    displays notes when present
    displays todays doses section
    shows no doses message when no takes today
    displays taken doses with timestamp and amount
  Take Button
    when prescription can be taken
      displays enabled Take button
      has correct button styling
      submits take medicine form when clicked
      records correct timestamp for take
      records correct dosage amount
      updates the card to show the new take
    when medicine is out of stock
      displays disabled Out of Stock button
      has grayscale styling when out of stock
    when prescription cannot be taken (cooldown)
      displays disabled Take button
      has grayscale styling when disabled
      shows countdown notice
  Edit Button
    when user is administrator
      displays Edit icon link
      navigates to edit page when clicked
    when user is non-administrator
      does not display Edit button
  Delete Button
    when user is administrator
      displays Delete button (trash icon)
    when user is non-administrator
      does not display Delete button
  Button Consistency
    all buttons have consistent rounded styling (xl/2xl)
    Take button uses Button component (not Link)
  Accessibility
    Take button is keyboard accessible
    card has proper semantic structure
  Multiple Takes in One Day
    displays all takes from today in reverse chronological order
    does not display takes from previous days

Two-Factor Authentication Management
  Two-Factor Authentication Card
    displays the 2FA management card
    shows all 2FA method sections
  TOTP Management
    when TOTP is not enabled
      shows setup button
    when TOTP is enabled
      shows authenticator app enabled status
      shows authenticator app disable button
  Recovery Codes Management
    when recovery codes are not generated
      shows setup button
    when recovery codes exist
      shows recovery codes view button
      shows recovery codes regenerate button
  Passkeys Management
    when no passkeys exist
      shows empty state
      shows add button
    when passkeys exist
      lists all passkeys
      shows remove button for each passkey
      shows add another button
  Navigation
    has link to TOTP setup page
    has link to recovery codes page
    has link to passkey setup page
  MFA setup flows
    allows setting up and disabling TOTP
    allows generating recovery codes after 2FA setup
    when a passkey is already registered
      redirects to the 2FA method chooser when starting TOTP setup
      redirects to the 2FA method chooser when viewing recovery codes
      redirects to the 2FA method chooser when adding another passkey
      redirects to the 2FA method chooser when removing a passkey
  disabling the authenticator app
    routes to the Rodauth OTP disable endpoint

OIDC Login page without credentials
  does not show OIDC button when credentials are not configured

User Signup
  creating a new account
    redirects to login when an administrator already exists and no invitation token is present
    creates both an Account and a Person with valid details
    shows validation errors when name is missing
    shows validation errors when date of birth is missing
    shows validation errors when passwords do not match
    shows validation errors when email is already taken
    sets person_type based on age (adult for 18+)
    sets person_type based on age (minor for under 18)

OIDC Security Initializer
  OidcSecurity module
    .configured?
      returns false when no OIDC credentials are set
      returns true when environment variables are set
      returns true when Rails credentials are set
    .validate_issuer_url!
      accepts valid HTTPS URLs
      accepts HTTP URLs for localhost
      accepts HTTP for 127.0.0.1
      accepts HTTP for ::1
      rejects non-HTTPS URLs in non-localhost contexts
      rejects blank URLs
      rejects malformed URLs
    .secret_not_in_source?
      returns true when no hardcoded secrets are found
    after_initialize hook behavior
      validates redirect URI and logs warnings for invalid URIs
    .validate_redirect_uri!
      accepts a valid HTTPS redirect URI
      accepts HTTP for localhost
      accepts HTTP for 127.0.0.1
      rejects non-HTTPS URIs for non-localhost
      rejects blank redirect URI
      rejects malformed redirect URI

OTEL-014: Sensitive data scrubbed from traces
  PG instrumentation configuration
    obfuscates SQL statements instead of including raw SQL
  Rack instrumentation configuration
    does not record request headers that may contain sensitive data
  SpanSanitizer processor
    is registered as a span processor

Otel::SpanSanitizer
  #sanitize_value
    redacts email addresses
    redacts emails embedded in longer strings
    redacts multiple emails in one string
    redacts date-of-birth patterns (YYYY-MM-DD)
    redacts date-of-birth patterns (DD/MM/YYYY)
    redacts IP addresses
    redacts IP addresses embedded in strings
    preserves non-sensitive strings
    preserves numeric IDs
    preserves ISO 8601 timestamps with time component
    returns non-string values unchanged
  #sanitize_attributes
    redacts values for sensitive attribute keys
    redacts PII patterns in attribute values even for non-sensitive keys
    redacts values for keys containing name, email, or password
    does not modify the original hash
  .sensitive_key?
    identifies authorization headers as sensitive
    identifies cookie headers as sensitive
    identifies name fields as sensitive
    identifies email fields as sensitive
    identifies password fields as sensitive
    identifies date_of_birth fields as sensitive
    does not flag model.name as sensitive
    does not flag model.id as sensitive
    does not flag model.operation as sensitive

Otel::SpanSanitizingProcessor
  #on_start
    sanitizes email addresses in span attributes
    sanitizes sensitive header attributes
    preserves non-sensitive attributes
    redacts IP addresses in attribute values
  #on_finish
    responds to on_finish
  #force_flush
    returns success
  #shutdown
    returns success

InvitationMailer
  #invite
    renders the recipient email
    renders the subject
    renders the sender email
    includes the invitation acceptance URL in the body
    includes the role in the body
    is a plain text email

Account
  associations
    is expected to have one person dependent => nullify
  enum
    is expected to define :status as an enum backed by an integer with values ‹{unverified: 1, verified: 2, closed: 3}›

CarerRelationship
  associations
    is expected to belong to carer class_name => Person required: true
    is expected to belong to patient class_name => Person required: true
  validations
    validates uniqueness of carer_id scoped to patient_id
    requires relationship_type
  scopes
    has an active scope
  #deactivate!
    sets active to false
  #activate!
    sets active to true
  versioning
    creates version on relationship creation
    creates version on relationship update
    tracks activation/deactivation changes
    associates version with current user

Dosage
  validations
    is expected to validate that :amount cannot be empty/falsy
    is expected to validate that :unit cannot be empty/falsy
    is expected to validate that :frequency cannot be empty/falsy
    is expected to validate that :amount looks like a number greater than 0
  associations
    is expected to belong to medicine required: true
    is expected to have many prescriptions dependent => destroy

Invitation
  validations
    is expected to validate that :email cannot be empty/falsy
    is expected to validate that :role cannot be empty/falsy
    is expected to allow :email to be ‹"test@example.com"›
    is expected not to allow :email to be ‹"invalid-email"›
  enums
    defines role enum
  callbacks
    generates a token before creation
    sets expiration date before creation
  scopes
    .pending
      returns only pending invitations
  #expired?
    returns true if expires_at is in the past
    returns false if expires_at is in the future
  #accepted?
    returns true if accepted_at is present
    returns false if accepted_at is nil

MedicationTake
  validations
    is expected to validate that :taken_at cannot be empty/falsy
  associations
    is expected to belong to prescription optional: true
    is expected to belong to person_medicine optional: true
  source validation
    when neither prescription nor person_medicine is set
      is invalid
    when both prescription and person_medicine are set
      is invalid
    when only prescription is set
      is valid
    when only person_medicine is set
      is valid
  stock tracking
    when taking a dose from a prescription
      does not deduct from the medicine stock (baseline capacity)
      deducts 1 from the medicine current_supply
    when taking a dose from a person_medicine
      deducts 1 from the medicine current_supply
  versioning
    creates version when medication is taken
    creates version on medication take update
    tracks time changes for medication takes
    associates version with current user
    records IP address when controller_info is set

Medicine
  validations
    is expected to validate that :name cannot be empty/falsy
    is expected not to validate that :current_supply cannot be empty/falsy
    is expected to validate that :current_supply looks like an integer greater than or equal to 0 as long as it is not nil
    is expected to validate that :stock looks like an integer greater than or equal to 0 as long as it is not nil
    is expected to validate that :reorder_threshold looks like an integer greater than or equal to 0
  associations
    is expected to have many dosages dependent => destroy
    is expected to have many prescriptions dependent => destroy
  #low_stock?
    when current_supply is below the reorder threshold
      returns true
    when current_supply meets the reorder threshold
      returns true
    when current_supply is above the reorder threshold
      returns false
  #out_of_stock?
    when current_supply is 0
      is expected to be out of stock
    when current_supply is positive
      is expected not to be out of stock
    when current_supply is nil (untracked)
      is expected not to be out of stock

PersonMedicine
  #can_take_now?
    without timing restrictions
      returns true
    with max_daily_doses restriction
      returns false when max doses reached
      returns true when under max doses
    with min_hours_between_doses restriction
      returns false when minimum hours not passed
      returns true when minimum hours passed
    with both restrictions
      returns false when either restriction violated
  #next_available_time
    without timing restrictions
      returns nil
    when can take now
      returns current time
    with min_hours_between_doses restriction
      returns time when minimum hours will be satisfied
    with max_daily_doses restriction
      returns start of next day when max doses reached
    with both restrictions
      returns the earliest time when restrictions are satisfied
  #time_until_next_dose
    when can take now
      returns nil
    when restricted
      returns seconds until next available time
  #can_administer?
    when can take now and medicine in stock
      returns true
    when on cooldown
      returns false
    when medicine is out of stock
      returns false
    when both on cooldown and out of stock
      returns false
    when medicine current_supply is nil (untracked)
      returns true (nil current_supply means untracked)
  #administration_blocked_reason
    when can administer
      returns nil
    when on cooldown
      returns :cooldown
    when out of stock
      returns :out_of_stock
    when both on cooldown and out of stock
      returns :out_of_stock (stock takes priority)
  #countdown_display
    when can take now
      returns nil
    with hours remaining
      returns formatted time string
    with only minutes remaining
      returns formatted time string with minutes only
    with less than a minute remaining
      returns "less than 1 minute"

Person
  associations
    is expected to have one user inverse_of => person dependent => destroy
    is expected to have many prescriptions dependent => destroy
    is expected to have many medicines through prescriptions
    is expected to have many carer_relationships dependent => destroy
    is expected to have many active_carer_relationships
    is expected to have many carers through active_carer_relationships
    is expected to have many patient_relationships dependent => destroy
    is expected to have many active_patient_relationships
    is expected to have many patients through active_patient_relationships
  validations
    is expected to validate that :name cannot be empty/falsy
    is expected to validate that :date_of_birth cannot be empty/falsy
    is expected to validate that :email is case-insensitively unique
    allows a blank email
    enforces case-insensitive uniqueness when email is present
    allows a person without a user account
  person types
    defaults to adult type
    can be a minor
    can be a dependent adult
  #age
    calculates age correctly
    handles birthdays correctly
    returns nil when date_of_birth is nil
  #adult?
    returns true for person 18 years or older with adult person_type
    returns true for person with adult person_type regardless of age
    returns true for person 18 years or older even without adult person_type
    returns false for person under 18 without adult person_type
  #minor?
    returns true for person under 18 with minor person_type
    returns false for person 18 years or older even with minor person_type
    returns false for person under 18 without minor person_type
    returns false for person exactly 18 years old
  capacity
    has capacity by default
    can be marked as lacking capacity when carer is assigned
  carer requirement validation
    requires carer when has_capacity is false and no carers assigned
    allows saving when has_capacity is false and carer is assigned
    allows saving when has_capacity is true without carers
    prevents removing capacity when no carers assigned
    allows removing capacity when carer is already assigned
    requires active carer when has_capacity is false and only inactive carers exist
  carer relationships
    can have carers assigned
    can have multiple carers
    can specify relationship type
    with active and inactive relationships
      active_carer_relationships only returns active relationships
      carer_relationships returns all relationships
      carers only returns carers with active relationships
      active_patient_relationships only returns active relationships
      patients only returns patients with active relationships
  #dependent_adult?
    returns true for person 18 years or older with dependent_adult person_type
    returns false for person under 18 even with dependent_adult person_type
    returns false for person 18 years or older without dependent_adult person_type
  #needs_carer?
    when person is adult type
      returns false even without carers
      returns false with carers assigned
    when person is minor type
      returns true without carers
      returns false with carers assigned
    when person is dependent_adult type
      returns true without carers
      returns false with carers assigned
  versioning
    creates version on person creation
    creates version on person update
    tracks sensitive field changes
    associates version with current user

Prescription
  active flag
    is active by default
    can be set to inactive
    can be reactivated
  validations
    is expected to validate that :start_date cannot be empty/falsy
    is expected to validate that :end_date cannot be empty/falsy
    is invalid if end_date is before start_date
  #can_administer?
    when can take now and medicine in stock
      returns true
    when medicine is out of stock
      returns false
    when medicine current_supply is nil (untracked)
      returns true
  #administration_blocked_reason
    returns :out_of_stock when medicine has no supply
  associations
    is expected to belong to person required: true
    is expected to belong to dosage required: true
    is expected to have many medication_takes dependent => destroy

User
  defaults to parent role for new users
  allows explicitly setting administrator role

User
  validations
    is expected to validate that :email_address cannot be empty/falsy
    is expected to validate that :email_address is case-insensitively unique
    is expected to allow :email_address to be ‹"user@example.com"›
    is expected not to allow :email_address to be ‹"user@example"›
    is expected not to allow :email_address to be ‹"userexample.com"›
  associations
    is expected to belong to person inverse_of => user required: true
    is expected to have many prescriptions through person
  person linkage
    requires an associated person
  callbacks
    assigns the person association before validation
  security
    is expected to have a secure password, defined on password attribute
  roles
    is expected to define :role as an enum backed by an integer with values ‹{administrator: 0, doctor: 1, nurse: 2, carer: 3, parent: 4, minor: 5}›
    can be an administrator
    can be a doctor
    can be a nurse
    can be a carer
    can be a parent
    can be a minor
  normalization
    downcases the email address before saving
  account activation
    #deactivate!
      sets active to false
    #activate!
      sets active to true
    scopes
      returns only active users with .active scope
      returns only inactive users with .inactive scope
  versioning
    creates version on user creation
    creates version on user update
    associates version with current user
    does not track password changes
    stores version when changes occur

AuditLogPolicy
  when user is an administrator
    is expected to permit [:index]
    is expected to permit [:show]
    is expected to forbid [:create]
    is expected to forbid [:update]
    is expected to forbid [:destroy]
  when user is a doctor
    is expected to forbid [:index]
    is expected to forbid [:show]
  when user is a nurse
    is expected to forbid [:index]
    is expected to forbid [:show]
  when user is a carer
    is expected to forbid [:index]
    is expected to forbid [:show]
  when user is a parent
    is expected to forbid [:index]
    is expected to forbid [:show]

CarerRelationshipPolicy
  when user is an administrator
    permits all actions
  when user is a doctor
    permits viewing but not management
  when user is a nurse
    permits viewing but not management
  when user is a carer
    forbids listing all relationships
    forbids creating relationships
    with their own carer relationship
      permits viewing only
    with another carer relationship
      forbids viewing
  when user is nil
    forbids all actions
  Scope
    when user is an administrator
      returns all relationships
    when user is a doctor
      returns all relationships
    when user is a nurse
      returns all relationships
    when user is a carer
      returns only their carer relationships
    when user is nil
      returns no records

DashboardPolicy
  #index?
    when user is authenticated
      is expected to permit [:index]
    when user is a doctor
      is expected to permit [:index]
    when user is a nurse
      is expected to permit [:index]
    when user is a carer
      is expected to permit [:index]
    when user is a parent
      is expected to permit [:index]
    when user is an adult patient
      is expected to permit [:index]
    when user is nil
      is expected not to permit [:index]

InvitationPolicy
  when user is an administrator
    permits index
    permits create
  when user is a doctor
    forbids index
    forbids create
  when user is a nurse
    forbids index
    forbids create
  when user is a carer
    forbids index
    forbids create
  when user is a parent
    forbids index
    forbids create
  when user is a minor
    forbids index
    forbids create

MedicationTakePolicy
  #create?
    when user is an administrator
      is expected to permit [:create]
    when user is a doctor
      is expected to permit [:create]
    when user is a nurse
      is expected to permit [:create]
    when user is a carer
      with assigned patient
        is expected to permit [:create]
      with non-assigned patient
        is expected not to permit [:create]
      with assigned patient person_medicine take
        is expected to permit [:create]
      with non-assigned patient person_medicine take
        is expected not to permit [:create]
    when user is a parent
      with their minor child
        is expected to permit [:create]
      with non-child patient
        is expected not to permit [:create]
      with minor child person_medicine take
        is expected to permit [:create]
      with non-child person_medicine take
        is expected not to permit [:create]
    when user is an adult patient
      with their own prescription
        is expected to permit [:create]
      with another patient prescription
        is expected not to permit [:create]
      with their own person_medicine take
        is expected to permit [:create]
      with someone else person_medicine take
        is expected not to permit [:create]
    when user is nil
      is expected not to permit [:create]
  #new?
    is expected to permit [:new]
  Scope
    #resolve
      when user is an administrator
        returns all medication takes
      when user is a doctor
        returns all medication takes
      when user is a nurse
        returns all medication takes
      when user is a carer
        returns medication takes for assigned patients only, including person_medicine takes
      when user is a parent
        returns medication takes for their minor children only, including person_medicine takes
      when user is an adult patient
        returns only their own medication takes, including person_medicine takes
      when user is nil
        returns no medication takes
      when user has no person
        returns all medication takes for admin

MedicinePolicy
  for administrator
    permits all actions
  for doctor
    permits most actions except destroy
  for nurse
    permits viewing only
  for carer
    forbids all actions
  for parent
    forbids all actions
  for patient
    forbids all actions
  for nil user
    forbids all actions
  Scope
    when user is an administrator
      returns all medicines
    when user is a doctor
      returns all medicines
    when user is a nurse
      returns all medicines
    when user is a carer
      returns no medicines
    when user is a parent
      returns no medicines
    when user is nil
      returns no medicines

PersonMedicinePolicy
  #show?
    when user is an administrator
      is expected to permit [:show]
    when user is a doctor
      is expected to permit [:show]
    when user is a nurse
      is expected to permit [:show]
    when user is a carer with assigned patient
      is expected to permit [:show]
    when user is a carer without assigned patient
      is expected not to permit [:show]
    when user views their own person medicine
      is expected to permit [:show]
  #create?
    when user is an administrator
      is expected to permit [:create]
    when user creates for themselves
      is expected to permit [:create]
    when parent creates for their child
      is expected not to permit [:create]
    when carer creates for assigned patient
      is expected not to permit [:create]
    when user creates for unrelated person
      is expected not to permit [:create]
    when user is nil
      is expected not to permit [:create]
  #new?
    when user is an administrator
      is expected to permit [:new]
    when user is a parent
      is expected to permit [:new]
    when user is an adult patient
      is expected to permit [:new]
  #update?
    when user is an administrator
      is expected to permit [:update]
    when user updates their own
      is expected to permit [:update]
    when parent updates for their child
      is expected not to permit [:update]
    when user updates for unrelated person
      is expected not to permit [:update]
  #destroy?
    when user is an administrator
      is expected to permit [:destroy]
    when user destroys their own
      is expected to permit [:destroy]
    when user destroys for unrelated person
      is expected not to permit [:destroy]
  #take_medicine?
    when user is an administrator
      is expected to permit [:take_medicine]
    when user takes their own medicine
      is expected to permit [:take_medicine]
    when parent takes medicine for their child
      is expected to permit [:take_medicine]
    when carer takes medicine for assigned patient
      is expected to permit [:take_medicine]
    when user takes medicine for unrelated person
      is expected not to permit [:take_medicine]
  Scope
    #resolve
      when user is an administrator
        returns all person medicines
      when user is a doctor
        returns all person medicines
      when user is an adult patient
        returns only their own person medicines
      when user is a parent
        returns only their own person medicines (not children)
      when user is nil
        returns no person medicines

PersonPolicy
  when user is an administrator
    permits viewing and management actions except create
    forbids creating people directly (security)
  when user is a doctor
    permits viewing but not management actions
  when user is a nurse
    permits viewing but not management actions
  when user is a parent/carer
    allows accessing index (but scope limits to assigned people)
    with their own record
      permits viewing only
    with an assigned patient
      permits viewing only
    with an unrelated person
      forbids viewing
  when user is nil
    forbids all actions
  Scope
    when user is an administrator
      returns all people
    when user is a doctor
      returns all people
    when user is a nurse
      returns all people
    when user is a parent/carer
      returns only their person and assigned patients
    when user is nil
      returns no records

PrescriptionPolicy
  for administrator
    permits all actions
  for doctor
    permits all actions
  for nurse
    permits viewing and administering only
  for carer with assigned patient
    permits viewing and administering
  for carer without assigned patient
    forbids all actions
  for parent with child
    permits viewing and administering
  for parent without child
    forbids access
  for adult patient with own prescription
    permits viewing and taking own medicine
  for minor with own prescription
    allows viewing own prescription
    does not allow taking medicine without parent/carer
    forbids management actions
  for nil user
    forbids all actions
  Scope
    when user is an administrator
      returns all prescriptions
    when user is a doctor
      returns all prescriptions
    when user is an adult patient
      returns only their own prescriptions
    when user is a carer
      returns prescriptions for assigned patients
    when user is a parent
      returns prescriptions for their children only
    when user is nil
      returns no prescriptions

UserPolicy
  when user is an administrator
    permits all actions
  when user is a doctor
    forbids administrative actions
    when viewing own profile
      permits viewing and updating
    when viewing another user
      forbids viewing and updating
  when user is a nurse
    forbids administrative actions
    when viewing own profile
      permits viewing and updating
    when viewing another user
      forbids viewing and updating
  when user is a carer
    forbids administrative actions
    when viewing own profile
      permits viewing and updating
    when viewing another user
      forbids viewing and updating
  when user is a parent
    forbids administrative actions
    when viewing own profile
      permits viewing and updating
    when viewing another user
      forbids viewing and updating
  Scope
    when user is an administrator
      returns all users
    when user is not an administrator
      returns only the current user

DashboardPresenter
  #people
    when user is an administrator
      returns all people
    when user is a carer
      returns patients of the carer
      returns Person.none when carer has no associated person
    when user is a parent
      returns minor patients of the parent
      returns Person.none when parent has no associated person
    when user is a minor (no special access)
      returns only their own person record
      returns Person.none when minor has no associated person
    when current_user is nil
      returns Person.none
    when carer user has no associated person
      returns Person.none without raising
    when parent user has no associated person
      returns Person.none without raising
    when non-privileged user has no associated person
      returns Person.none without raising
  #active_prescriptions
    returns date-active prescriptions for scoped people
    excludes prescriptions whose end_date is in the past
    excludes prescriptions whose start_date is in the future
  #upcoming_prescriptions
    groups prescriptions by person
  #doses
    delegates to FamilyDashboard::ScheduleQuery

Admin::AuditLogs Rate Limiting
  IP-based rate limiting on GET /admin/audit_logs
    allows requests under the limit
    throttles requests exceeding 100 per minute
    includes Retry-After header when throttled
  IP-based rate limiting on GET /admin/audit_logs/:id
    throttles show endpoint as part of the same limit
  user-based rate limiting
    allows different users to have separate rate limit counters
    throttles at IP limit (100) before reaching user limit (200)
  rate limit does not affect other endpoints
    does not throttle non-audit endpoints even after many requests
  rate limit logging
    logs rate limit violations

Admin::AuditLogs
  GET /admin/audit_logs
    when authenticated as administrator
      returns success
      returns HTML content type
    when authenticated as non-administrator
      denies access
    when not authenticated
      redirects to login
  GET /admin/audit_logs with filters
    accepts item_type filter parameter
    accepts event filter parameter
    accepts page parameter
  GET /admin/audit_logs/:id
    when authenticated as administrator
      returns success
      returns HTML content type
    when authenticated as non-administrator
      denies access
    when not authenticated
      redirects to login

Form inline validation feedback
  MedicinesController with validation errors
    displays inline error messages next to invalid fields
    displays error summary at the top of the form
    adds error styling to fields with errors

Medication Timing Restrictions
  POST /people/:person_id/prescriptions/:id/take_medicine
    when timing restrictions allow taking medicine
      creates a medication take
    when max daily doses reached
      does not create a medication take
    when minimum hours between doses not met
      does not create a medication take
  POST /people/:person_id/person_medicines/:id/take_medicine
    when timing restrictions allow taking medicine
      creates a medication take
    when max daily doses reached
      does not create a medication take
    when minimum hours between doses not met
      does not create a medication take

GET /medicine-finder/search
  GET /medicine-finder/search.json
    with a valid query
      returns 200 OK
      returns JSON with results
    with a blank query
      returns 200 with empty results
    when the API is unavailable
      returns 200 with an error message
    when the NHS dm+d service is not configured (credentials absent)
      returns 200 with a not_configured error
    when the user is not authenticated
      redirects to login
    when the user is a carer (not authorised)
      redirects with not authorized

Optimistic UI updates for take medicine buttons
  prescription card
    renders take button with optimistic-take controller data attributes
  person medicine card
    renders take button with optimistic-take controller data attributes

PersonMedicinesController policy scoping
  GET /people/:person_id/person_medicines/new
    when user role is excluded from MedicinePolicy::Scope
      uses policy_scope to restrict visible medicines
    when user role is included in MedicinePolicy::Scope
      shows all medicines
  POST /people/:person_id/person_medicines
    when user role is excluded from MedicinePolicy::Scope and validation fails
      uses policy_scope for medicines on re-render

PWA
  GET /manifest.webmanifest
    returns the web manifest with app metadata
  GET /service-worker.js
    returns the service worker javascript
  manifest link tag in layout
    includes a manifest link in the application layout
  Content-Security-Policy
    includes worker-src self to allow service worker registration

Redirect back after form submission
  MedicinesController
    when updating a medicine with a referrer
      redirects back to the referrer
    when updating a medicine without a referrer
      redirects to the medicine show page as fallback
  PeopleController
    when updating a person with a referrer
      redirects back to the referrer
    when updating a person without a referrer
      redirects to the person show page as fallback

Toast notifications for async actions
  POST /people/:person_id/prescriptions/:id/take_medicine
    with turbo_stream format
      returns turbo_stream response with flash update on success
      returns turbo_stream response with flash update on failure
    with html format
      still redirects as before
  POST /people/:person_id/person_medicines/:id/take_medicine
    with turbo_stream format
      returns turbo_stream response with flash update on success

OIDC Security
  OIDC-SEC-009: Client secret stored securely
    does not expose client secret in Rodauth configuration source
    reads client secret from credentials or environment variables only
    does not have hardcoded secrets in source files
  OIDC-SEC-008: Authorization code flow
    configures response_type as code (not implicit)
    does not use implicit flow
  OIDC-SEC-001: Token signature verification via JWKS
    enables discovery mode for automatic JWKS fetching
  OIDC-SEC-004: Issuer validation
    configures issuer in provider options
  OIDC-SEC-005: State parameter CSRF protection
    has omniauth feature enabled which provides state parameter
  OIDC-SEC-010: Redirect URI validation
    configures explicit redirect_uri in client options
    uses /auth/oidc/callback path
  OIDC-SEC-007: Access token not stored long-term
    stores only provider and UID in account_identities table
  OIDC-SEC-011: Account hijacking prevention via email verification
    marks OIDC accounts as verified to prevent hijacking
  OIDC-SEC-012: Session fixation prevention
    has active_sessions feature enabled for session management
  OIDC configuration uses openid_connect gem
    uses omniauth_openid_connect gem instead of google-specific gem
    configures provider as openid_connect with name :oidc
    requests openid, email, and profile scopes
    uses sub as uid_field
  OIDC-SEC-002: Token expiration prevents replay attacks
    uses openid_connect gem which validates token expiration automatically
    does not store tokens long-term, forcing expiration validation
  OIDC-SEC-003: Audience claim validation prevents token misuse
    configures client identifier which enables audience validation
    uses openid_connect gem which validates audience claim automatically
  OIDC-SEC-006: Nonce prevents token replay attacks
    uses openid_connect gem which handles nonce automatically
    enables omniauth feature which provides nonce support

Seeds
  loads the damacus admin user from fixtures
  loads an admin user
  has the damacus person associated with the user

Admin::BootstrapService
  .call
    creates account, person, and administrator user when no admin exists
    creates an active adult administrator linked to a verified account
    refuses to bootstrap when an administrator already exists
    refuses to bootstrap when account or user exists with same email
    rolls back account and person when user creation fails

FamilyDashboard::ScheduleQuery
  #call
    returns an aggregated list of doses for the person and their dependents
    includes prescription doses from both the parent and the child
    includes person_medicine (non-prescription) doses
    returns doses sorted by scheduled_at
    correctly identifies doses already taken today
    filters out inactive prescriptions

NhsDmd::Client
  #search
    when the API returns results
      returns an array of hashes with code, display, and concept_class
      includes the concept_class when present in extensions
      sets concept_class to nil when extension is absent
    when the API returns no results
      returns an empty array
    when the API returns no expansion key
      returns an empty array
    when the API returns a non-200 status
      raises NhsDmd::Client::ApiError
    when the request times out
      raises NhsDmd::Client::ApiError
    when the query is blank
      returns an empty array without making an HTTP request
    when credentials are not configured
      returns an empty array without making an HTTP request
    when authenticated with credentials
      includes an Authorization header in the request
    with a custom count
      passes the count parameter to both VMP and AMP API requests

NhsDmd::Search
  #call
    when the service is not configured (credentials absent)
      returns a not-configured error result without calling search
    when the query is blank
      returns a successful result with empty results without calling the client
    when the client returns results
      returns a successful result
      maps raw results to SearchResult objects
      populates SearchResult attributes correctly
    when the client raises an ApiError
      returns a result with an error message
      returns empty results on error

SpecFixtureLoader
  .load
    loads the requested fixtures into the database

Admin Dashboard
  when user is an administrator
    displays key system metrics
    displays correct user counts by role
    provides navigation links to management pages
  when user is not an administrator
    redirects non-admin users
  when user is not signed in
    redirects to login

Admin invites users
  allows an admin to send a user invitation email
  allows an invitee to accept an invitation

AdminManagesCarerRelationships
  when user is logged in as an admin
    allows admin to see the list of carer relationships
    allows admin to create a new carer relationship
    allows admin to deactivate a carer relationship
    allows admin to reactivate a deactivated carer relationship
    allows carer to access patient after relationship is reactivated
  when user is logged in as a non-admin
    denies access to the carer relationships list

AdminManagesUsers
  when user is logged in as an admin
    allows admin to see the list of users
    allows admin to create a new user
    shows validation errors when creating user with invalid data
    shows error when creating user with duplicate email
    creates user that can immediately log in
    allows admin to edit an existing user
    shows validation errors when updating user with invalid data
    allows admin to deactivate a user
    allows admin to reactivate a deactivated user
    prevents admin from deactivating themselves
    allows admin to search users by name
    allows admin to search users by email
    allows admin to filter users by role
    allows admin to filter users by status
    allows admin to filter active users only
    shows pagination info
    allows admin to combine search and filter
    shows all users when search is cleared
  when user is logged in as a non-admin
    denies access to the user list
    denies access to create new users

Admin Access Authorization
  admin user management
    allows administrators to access user management
    denies non-administrators access to user management
  people management
    allows administrators to view all people
    restricts carers to viewing only their assigned people

Carer Access Authorization
  viewing people
    allows carers to view their own profile
    allows carers to view assigned patients
    denies carers access to unrelated people
  managing people
    denies carers ability to create new people
    denies carers ability to edit people
    denies carers ability to delete people
  people index
    shows only accessible people to carers

Clinician Access Authorization
  viewing people
    allows doctors to view all people
    allows nurses to view all people
    allows doctors to view any person
  managing people
    denies doctors ability to create new people
    denies nurses ability to edit people
    denies doctors ability to delete people
  user management
    denies doctors access to user management
    denies nurses access to user management

Dashboard Authorization
  dashboard access
    allows administrators to access dashboard
    allows doctors to access dashboard
    allows nurses to access dashboard
    allows carers to access dashboard
    allows parents to access dashboard
    allows adult patients to access dashboard
    denies unauthenticated users access to dashboard
  dashboard data scoping
    shows all people to administrators
    shows only assigned patients to carers
    shows only minor children to parents
    shows only themselves to adult patients

Medication Takes Authorization
  viewing prescriptions to record medication takes
    when user is authorized
      allows administrators to view any prescription
      allows doctors to view any prescription
      allows nurses to view any prescription
      allows carers to view prescriptions for assigned patients
      allows parents to view prescriptions for their minor children
      allows adult patients to view their own prescriptions
    when user is not authorized
      denies carers from viewing prescriptions for unassigned patients
      denies parents from viewing prescriptions for non-children
      denies adult patients from viewing others prescriptions

Person Medicines Authorization
  adding medicines
    allows administrators to add medicines to any person
    denies doctors ability to add medicines
    denies nurses ability to add medicines
    denies carers ability to add medicines to unrelated people
    denies carers ability to add medicines to their assigned patients
  taking medicines
    allows carers to take medicine for assigned patients
    denies doctors ability to take medicines
    denies nurses ability to take medicines
    denies carers ability to take medicine for unrelated people
  removing medicines
    allows administrators to remove medicines from any person
    denies doctors ability to remove medicines
    denies nurses ability to remove medicines
    denies carers ability to remove medicines from assigned patients
  viewing medicines
    allows administrators to view medicines for any person
    allows doctors to view medicines for any person
    allows nurses to view medicines for any person
    allows carers to view medicines for assigned patients
    denies carers ability to view medicines for unrelated people

Dashboard
  loads the dashboard for a signed-in user and shows family-wide doses
  allows taking a dose directly from the dashboard

Home
  loads the dashboard as the home page for a signed-in user

MedicineFinder
  displays the medicine finder page

MedicineNewLayout
  allows creating a medicine with the redesigned form

Minor role in user form
  shows minor role in the dropdown
  allows creating a user with minor role

Mobile Navigation
  User sees mobile navigation elements on small viewport
  Desktop navigation is hidden on mobile viewport
  User can open the mobile menu
  Slide-out drawer is positioned on the left side
  Slide-out drawer has a semi-transparent backdrop
  Tapping backdrop dismisses the drawer
  Pressing Escape dismisses the drawer
  Drawer width is approximately 75-80% of viewport
  Drawer has accessible aria attributes
  Drawer can be reopened after dismissal
  Touch targets in drawer meet WCAG minimum size

Navigation Flow
  Login -> Profile -> Logout flow
    allows user to login, visit profile, and logout successfully
  Direct navigation when not logged in
    redirects to login when accessing profile
    redirects to login when accessing dashboard

Navigation
  when user is authenticated
    shows the sidebar with navigation links
    shows Administration link for admin users
  when user is not authenticated
    shows navigation with a login link

People
  index page
    displays list of people with their prescription counts
    shows active prescription count for person with prescriptions
    shows no active prescriptions for person without prescriptions
    provides link to add prescription
    provides link to view prescriptions when person has prescriptions
  patients without carers
    highlights dependent adults who need carer assignment
    highlights minors who need carer assignment
    does not highlight self-managing adults without carers
    does not highlight patients who have carers

Prescription dosage selection
  disables dosage select until medicine is selected

Profile Editing
  viewing profile
    displays user information
    shows account security section with change buttons
    shows danger zone with close account button
    has Stimulus controller attributes on sheet elements
    has AlertDialog for close account
  changing email
    opens sheet modal when clicking change
    updates email when saving
  changing password
    opens sheet modal when clicking change
  closing account
    shows confirmation dialog when clicking close account
    can cancel account closure

Two-Factor Soft Enforcement
  privileged users without 2FA
    shows notice to administrator on profile page
    does not show notice to administrator on dashboard
    shows notice to doctor on profile page
    shows notice to nurse on profile page
  non-privileged users without 2FA
    does not show notice to parent users on profile page
    does not show notice to carer users on profile page
  privileged users with 2FA enabled
    does not show notice on profile page when administrator has TOTP enabled
    does not show notice on profile page when administrator has passkey enabled

User Sessions
  login page
    displays the login form with all fields
    shows error messages for invalid login
    allows user to login with valid credentials
  logout
    allows a logged in user to sign out

Rake::Task
  invokes bootstrap service with environment variables
  fails fast when required environment variables are missing

Views::Reports::Index
  renders the health report heading
  renders the compliance stats
  renders the adherence timeline
  renders the inventory alert with interpolated data

Views::Rodauth::Login
  renders the login heading and brand
  renders the email and password fields
  renders the remember me checkbox
  renders the sign in button

Pending: (Failures listed here are expected and do not affect your suite's status)

  1) AUTH: OmniAuth Auto Linking auto-links an existing account based on email when logging in via OmniAuth
     # OIDC not configured
     # ./spec/features/authentication/omniauth_auto_link_spec.rb:19

  2) Medicine Lookup User views drug interactions (not yet implemented)
     # MLKP-015: drug interaction lookup not yet implemented
     Failure/Error: http.request(request)

     WebMock::NetConnectNotAllowedError:
       Real HTTP connections are disabled. Unregistered request: GET https://ontology.nhs.uk/production1/fhir/ValueSet/$expand?count=20&filter=Warfarin&url=https://dmd.nhs.uk/ValueSet/VMP with headers {'Accept'=>'application/json', 'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'Authorization'=>'Bearer mock-token', 'Host'=>'ontology.nhs.uk', 'User-Agent'=>'Ruby'}

       You can stub this request with the following snippet:

       stub_request(:get, "https://ontology.nhs.uk/production1/fhir/ValueSet/$expand?count=20&filter=Warfarin&url=https://dmd.nhs.uk/ValueSet/VMP").
         with(
           headers: {
       	  'Accept'=>'application/json',
       	  'Accept-Encoding'=>'gzip;q=1.0,deflate;q=0.6,identity;q=0.3',
       	  'Authorization'=>'Bearer mock-token',
       	  'Host'=>'ontology.nhs.uk',
       	  'User-Agent'=>'Ruby'
           }).
         to_return(status: 200, body: "", headers: {})

       registered request stubs:

       stub_request(:post, "https://ontology.nhs.uk/authorisation/auth/realms/nhs-digital-terminology/protocol/openid-connect/token").
         with(
           body: {"client_id" => "test-id", "client_secret" => "test-secret", "grant_type" => "client_credentials"})

       ============================================================
     # /usr/local/bundle/gems/webmock-3.26.1/lib/webmock/http_lib_adapters/net_http.rb:120:in 'Net::HTTP#request'
     # ./app/services/nhs_dmd/client.rb:61:in 'NhsDmd::Client#perform_request'
     # ./app/services/nhs_dmd/client.rb:37:in 'NhsDmd::Client#fetch_value_set'
     # ./app/services/nhs_dmd/client.rb:27:in 'NhsDmd::Client#search'
     # ./app/services/nhs_dmd/search.rb:19:in 'NhsDmd::Search#call'
     # ./app/controllers/medicines_controller.rb:77:in 'MedicinesController#search'
     # /usr/local/bundle/gems/turbo-rails-2.0.23/lib/turbo-rails.rb:24:in 'Turbo.with_request_id'
     # /usr/local/bundle/gems/turbo-rails-2.0.23/app/controllers/concerns/turbo/request_id_tracking.rb:10:in 'Turbo::RequestIdTracking#turbo_tracking_request_id'
     # /usr/local/bundle/gems/actiontext-8.1.2/lib/action_text/rendering.rb:24:in 'ActionText::Rendering::ClassMethods#with_renderer'
     # /usr/local/bundle/gems/actiontext-8.1.2/lib/action_text/engine.rb:72:in 'block (4 levels) in <class:Engine>'
     # /usr/local/bundle/gems/railties-8.1.2/lib/rails/engine/lazy_route_set.rb:60:in 'Rails::Engine::LazyRouteSet#call'
     # /usr/local/bundle/gems/rack-attack-6.8.0/lib/rack/attack.rb:105:in 'Rack::Attack#call'
     # /usr/local/bundle/gems/roda-3.101.0/lib/roda/plugins/middleware.rb:162:in 'Roda::RodaPlugins::Middleware::Forwarder#call'
     # /usr/local/bundle/gems/rodauth-rails-2.1.2/lib/rodauth/rails/middleware.rb:18:in 'block in Rodauth::Rails::Middleware#call'
     # /usr/local/bundle/gems/rodauth-rails-2.1.2/lib/rodauth/rails/middleware.rb:17:in 'Kernel#catch'
     # /usr/local/bundle/gems/rodauth-rails-2.1.2/lib/rodauth/rails/middleware.rb:17:in 'Rodauth::Rails::Middleware#call'
     # /usr/local/bundle/gems/rack-attack-6.8.0/lib/rack/attack.rb:105:in 'Rack::Attack#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/tempfile_reaper.rb:20:in 'Rack::TempfileReaper#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/etag.rb:29:in 'Rack::ETag#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/conditional_get.rb:31:in 'Rack::ConditionalGet#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/head.rb:15:in 'Rack::Head#call'
     # /usr/local/bundle/gems/rack-session-2.1.1/lib/rack/session/abstract/id.rb:274:in 'Rack::Session::Abstract::Persisted#context'
     # /usr/local/bundle/gems/rack-session-2.1.1/lib/rack/session/abstract/id.rb:268:in 'Rack::Session::Abstract::Persisted#call'
     # /usr/local/bundle/gems/lograge-0.14.0/lib/lograge/rails_ext/rack/logger.rb:18:in 'Rails::Rack::Logger#call_app'
     # /usr/local/bundle/gems/railties-8.1.2/lib/rails/rack/logger.rb:29:in 'Rails::Rack::Logger#call'
     # /usr/local/bundle/gems/request_store-1.7.0/lib/request_store/middleware.rb:19:in 'RequestStore::Middleware#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/method_override.rb:28:in 'Rack::MethodOverride#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/runtime.rb:24:in 'Rack::Runtime#call'
     # /usr/local/bundle/gems/propshaft-1.3.1/lib/propshaft/server.rb:37:in 'Propshaft::Server#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/sendfile.rb:131:in 'Rack::Sendfile#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/events.rb:131:in 'Rack::Events#call'
     # /usr/local/bundle/gems/railties-8.1.2/lib/rails/engine.rb:534:in 'Rails::Engine#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/urlmap.rb:76:in 'block in Rack::URLMap#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/urlmap.rb:60:in 'Array#each'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/urlmap.rb:60:in 'Rack::URLMap#call'
     # /usr/local/bundle/gems/rack-3.2.5/lib/rack/builder.rb:283:in 'Rack::Builder#call'
     # /usr/local/bundle/gems/capybara-3.40.0/lib/capybara/server/middleware.rb:60:in 'Capybara::Server::Middleware#call'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/configuration.rb:296:in 'Puma::Configuration::ConfigMiddleware#call'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/request.rb:103:in 'block in Puma::Request#handle_request'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/thread_pool.rb:355:in 'Puma::ThreadPool#with_force_shutdown'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/request.rb:102:in 'Puma::Request#handle_request'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/server.rb:503:in 'Puma::Server#process_client'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/server.rb:262:in 'block in Puma::Server#run'
     # /usr/local/bundle/gems/puma-7.2.0/lib/puma/thread_pool.rb:182:in 'block in Puma::ThreadPool#spawn_thread'
     # ------------------
     # --- Caused by: ---
     # Capybara::ElementNotFound:
     #   Unable to find button "View Interaction Details" that is not disabled
     #   /usr/local/bundle/gems/capybara-3.40.0/lib/capybara/node/finders.rb:312:in 'block in Capybara::Node::Finders#synced_resolve'

Failures:

  1) RubyUI::BreadcrumbEllipsis yields a custom block if provided
     Failure/Error: expect(rendered.css('span[role="presentation"]').inner_html).to include('custom-ellipsis')
       expected "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewbox=\"0 0 24 24\" fill=\"no..."1\"></circle><circle cx=\"5\" cy=\"12\" r=\"1\"></circle></svg><span class=\"sr-only\">More</span>" to include "custom-ellipsis"
     # ./spec/components/ruby_ui/breadcrumb_ellipsis_spec.rb:18:in 'block (2 levels) in <main>'
     # /usr/local/bundle/gems/webmock-3.26.1/lib/webmock/rspec.rb:39:in 'block (2 levels) in <top (required)>'

  2) RubyUI::BreadcrumbItem renders an inline list item
     Failure/Error: yield_content(&block)

     NoMethodError:
       undefined method 'yield_content' for an instance of RubyUI::BreadcrumbItem
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:11:in 'Phlex::Rails::SGML#method_missing'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/kit.rb:11:in 'Phlex::Kit::LazyLoader#method_missing'
     # ./app/components/ruby_ui/breadcrumb_item.rb:7:in 'block in RubyUI::BreadcrumbItem#view_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml/elements.rb:69:in 'Phlex::HTML::StandardElements#li'
     # ./app/components/ruby_ui/breadcrumb_item.rb:6:in 'RubyUI::BreadcrumbItem#view_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:79:in 'block (2 levels) in Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:323:in 'Phlex::SGML#around_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:69:in 'block in Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml/state.rb:23:in 'Phlex::SGML::State#around_render'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:66:in 'Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:45:in 'Phlex::SGML#call'
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:129:in 'block in Phlex::Rails::SGML#render_in'
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:125:in 'Phlex::Rails::SGML#render_in'
     # ./spec/support/phlex_helper.rb:11:in 'PhlexTestingSupport#render_inline'
     # ./spec/components/ruby_ui/breadcrumb_item_spec.rb:7:in 'block (2 levels) in <main>'
     # /usr/local/bundle/gems/webmock-3.26.1/lib/webmock/rspec.rb:39:in 'block (2 levels) in <top (required)>'

  3) RubyUI::BreadcrumbLink renders an anchor tag
     Failure/Error: yield_content(&block)

     NoMethodError:
       undefined method 'yield_content' for an instance of RubyUI::BreadcrumbLink
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:11:in 'Phlex::Rails::SGML#method_missing'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/kit.rb:11:in 'Phlex::Kit::LazyLoader#method_missing'
     # ./app/components/ruby_ui/breadcrumb_link.rb:7:in 'block in RubyUI::BreadcrumbLink#view_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml/elements.rb:69:in 'Phlex::HTML::StandardElements#a'
     # ./app/components/ruby_ui/breadcrumb_link.rb:6:in 'RubyUI::BreadcrumbLink#view_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:79:in 'block (2 levels) in Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:323:in 'Phlex::SGML#around_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:69:in 'block in Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml/state.rb:23:in 'Phlex::SGML::State#around_render'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:66:in 'Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:45:in 'Phlex::SGML#call'
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:129:in 'block in Phlex::Rails::SGML#render_in'
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:125:in 'Phlex::Rails::SGML#render_in'
     # ./spec/support/phlex_helper.rb:11:in 'PhlexTestingSupport#render_inline'
     # ./spec/components/ruby_ui/breadcrumb_link_spec.rb:7:in 'block (2 levels) in <main>'
     # /usr/local/bundle/gems/webmock-3.26.1/lib/webmock/rspec.rb:39:in 'block (2 levels) in <top (required)>'

  4) RubyUI::BreadcrumbPage renders a span with current=page aria attribute
     Failure/Error: yield_content(&block)

     NoMethodError:
       undefined method 'yield_content' for an instance of RubyUI::BreadcrumbPage
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:11:in 'Phlex::Rails::SGML#method_missing'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/kit.rb:11:in 'Phlex::Kit::LazyLoader#method_missing'
     # ./app/components/ruby_ui/breadcrumb_page.rb:12:in 'block in RubyUI::BreadcrumbPage#view_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml/elements.rb:69:in 'Phlex::HTML::StandardElements#span'
     # ./app/components/ruby_ui/breadcrumb_page.rb:6:in 'RubyUI::BreadcrumbPage#view_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:79:in 'block (2 levels) in Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:323:in 'Phlex::SGML#around_template'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:69:in 'block in Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml/state.rb:23:in 'Phlex::SGML::State#around_render'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:66:in 'Phlex::SGML#internal_call'
     # /usr/local/bundle/gems/phlex-2.4.1/lib/phlex/sgml.rb:45:in 'Phlex::SGML#call'
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:129:in 'block in Phlex::Rails::SGML#render_in'
     # /usr/local/bundle/gems/phlex-rails-2.4.0/lib/phlex/rails/sgml.rb:125:in 'Phlex::Rails::SGML#render_in'
     # ./spec/support/phlex_helper.rb:11:in 'PhlexTestingSupport#render_inline'
     # ./spec/components/ruby_ui/breadcrumb_page_spec.rb:7:in 'block (2 levels) in <main>'
     # /usr/local/bundle/gems/webmock-3.26.1/lib/webmock/rspec.rb:39:in 'block (2 levels) in <top (required)>'

Top 20 slowest examples (30.75 seconds, 23.0% of total time):
  Navigation Flow Login -> Profile -> Logout flow allows user to login, visit profile, and logout successfully
    8.77 seconds ./spec/system/navigation_flow_spec.rb:11
  AdminManagesUsers when user is logged in as an admin creates user that can immediately log in
    4.05 seconds ./spec/system/admin_manages_users_spec.rb:98
  Admin::AuditLogs Rate Limiting user-based rate limiting allows different users to have separate rate limit counters
    1.45 seconds ./spec/requests/admin/audit_logs_rate_limiting_spec.rb:92
  Admin User Management Workflow completes full user lifecycle from creation to activation
    1.22 seconds ./spec/features/admin/user_management_workflow_spec.rb:14
  AdminManagesCarerRelationships when user is logged in as an admin allows carer to access patient after relationship is reactivated
    1.17 seconds ./spec/system/admin_manages_carer_relationships_spec.rb:80
  Prescription Card Edit Button when user is administrator navigates to edit page when clicked
    1.13 seconds ./spec/features/prescriptions/prescription_card_spec.rb:241
  Heading Order Accessibility Dashboard page has proper heading hierarchy
    1.11 seconds ./spec/features/accessibility/heading_order_spec.rb:42
  Prescription dosage selection disables dosage select until medicine is selected
    1.03 seconds ./spec/system/prescriptions/dosage_selection_spec.rb:15
  Admin::AuditLogs Rate Limiting IP-based rate limiting on GET /admin/audit_logs/:id throttles show endpoint as part of the same limit
    1.03 seconds ./spec/requests/admin/audit_logs_rate_limiting_spec.rb:68
  Admin::AuditLogs Rate Limiting user-based rate limiting throttles at IP limit (100) before reaching user limit (200)
    1.02 seconds ./spec/requests/admin/audit_logs_rate_limiting_spec.rb:106
  Prescription Card Delete Button when user is administrator displays Delete button (trash icon)
    0.91677 seconds ./spec/features/prescriptions/prescription_card_spec.rb:271
  Prescription Card Button Consistency Take button uses Button component (not Link)
    0.91389 seconds ./spec/features/prescriptions/prescription_card_spec.rb:308
  Prescription Card Button Consistency all buttons have consistent rounded styling (xl/2xl)
    0.91035 seconds ./spec/features/prescriptions/prescription_card_spec.rb:300
  Prescription Card Edit Button when user is administrator displays Edit icon link
    0.90357 seconds ./spec/features/prescriptions/prescription_card_spec.rb:234
  Two-Factor Authentication Management MFA setup flows allows setting up and disabling TOTP
    0.88301 seconds ./spec/features/profiles/two_factor_management_spec.rb:207
  Admin::AuditLogs Rate Limiting rate limit logging logs rate limit violations
    0.87469 seconds ./spec/requests/admin/audit_logs_rate_limiting_spec.rb:129
  Admin::AuditLogs Rate Limiting IP-based rate limiting on GET /admin/audit_logs throttles requests exceeding 100 per minute
    0.87367 seconds ./spec/requests/admin/audit_logs_rate_limiting_spec.rb:39
  Two-Factor Authentication Management disabling the authenticator app routes to the Rodauth OTP disable endpoint
    0.84305 seconds ./spec/features/profiles/two_factor_management_spec.rb:263
  Prescription Card Delete Button when user is non-administrator does not display Delete button
    0.82203 seconds ./spec/features/prescriptions/prescription_card_spec.rb:285
  Two-Factor Authentication Management MFA setup flows allows generating recovery codes after 2FA setup
    0.82144 seconds ./spec/features/profiles/two_factor_management_spec.rb:228

Top 20 slowest example groups:
  Navigation Flow
    2.97 seconds average (8.91 seconds / 3 examples) ./spec/system/navigation_flow_spec.rb:5
  Admin User Management Workflow
    1.22 seconds average (1.22 seconds / 1 example) ./spec/features/admin/user_management_workflow_spec.rb:5
  Prescription dosage selection
    1.03 seconds average (1.03 seconds / 1 example) ./spec/system/prescriptions/dosage_selection_spec.rb:5
  Admin::AuditLogs Rate Limiting
    0.88229 seconds average (7.06 seconds / 8 examples) ./spec/requests/admin/audit_logs_rate_limiting_spec.rb:5
  Admin invites users
    0.66892 seconds average (1.34 seconds / 2 examples) ./spec/system/admin_invites_users_spec.rb:5
  AdminManagesUsers
    0.61704 seconds average (12.34 seconds / 20 examples) ./spec/system/admin_manages_users_spec.rb:5
  AdminManagesCarerRelationships
    0.5493 seconds average (3.3 seconds / 6 examples) ./spec/system/admin_manages_carer_relationships_spec.rb:5
  Prescription Card
    0.53895 seconds average (16.71 seconds / 31 examples) ./spec/features/prescriptions/prescription_card_spec.rb:5
  Heading Order Accessibility
    0.46662 seconds average (3.27 seconds / 7 examples) ./spec/features/accessibility/heading_order_spec.rb:5
  Person Medicines
    0.46467 seconds average (2.32 seconds / 5 examples) ./spec/features/person_medicines_spec.rb:5
  Two-Factor Authentication Management
    0.45661 seconds average (10.5 seconds / 23 examples) ./spec/features/profiles/two_factor_management_spec.rb:6
  Mobile Navigation
    0.44673 seconds average (4.91 seconds / 11 examples) ./spec/system/mobile_navigation_spec.rb:5
  Home
    0.44492 seconds average (0.44492 seconds / 1 example) ./spec/system/home_spec.rb:5
  Profile Editing
    0.44487 seconds average (4.45 seconds / 10 examples) ./spec/system/profile_editing_spec.rb:5
  Admin User Edit Button
    0.4194 seconds average (0.8388 seconds / 2 examples) ./spec/features/admin/user_edit_button_spec.rb:5
  Medicine Stock Tracking
    0.39693 seconds average (1.98 seconds / 5 examples) ./spec/features/medicine_stock_tracking_spec.rb:5
  Clinician Access Authorization
    0.3934 seconds average (3.15 seconds / 8 examples) ./spec/system/authorization/clinician_access_spec.rb:5
  Medicine Lookup
    0.38679 seconds average (1.55 seconds / 4 examples) ./spec/features/medicine_lookup_spec.rb:5
  Admin Audit Logs
    0.38334 seconds average (7.67 seconds / 20 examples) ./spec/features/admin/audit_logs_spec.rb:5
  Person Medicines Authorization
    0.37835 seconds average (6.81 seconds / 18 examples) ./spec/system/authorization/person_medicines_authorization_spec.rb:5

Finished in 2 minutes 13.5 seconds (files took 2.03 seconds to load)
1054 examples, 4 failures, 2 pending

Failed examples:

rspec ./spec/components/ruby_ui/breadcrumb_ellipsis_spec.rb:15 # RubyUI::BreadcrumbEllipsis yields a custom block if provided
rspec ./spec/components/ruby_ui/breadcrumb_item_spec.rb:6 # RubyUI::BreadcrumbItem renders an inline list item
rspec ./spec/components/ruby_ui/breadcrumb_link_spec.rb:6 # RubyUI::BreadcrumbLink renders an anchor tag
rspec ./spec/components/ruby_ui/breadcrumb_page_spec.rb:6 # RubyUI::BreadcrumbPage renders a span with current=page aria attribute

