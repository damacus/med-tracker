<%= form_with(model: person_medicine, url: person_person_medicines_path(person), local: true, class: "w-full space-y-6") do |form| %>
  <% if person_medicine.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6">
      <h2 class="text-red-800 font-semibold"><%= pluralize(person_medicine.errors.count, "error") %> prohibited this medicine from being saved:</h2>
      <ul class="list-disc list-inside text-red-700 mt-2">
        <% person_medicine.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-6">
    <div class="space-y-2">
      <%= form.label :medicine_id, "Medicine", class: "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" %>
      <%= form.select :medicine_id, 
          options_from_collection_for_select(medicines, :id, :name, person_medicine.medicine_id),
          { prompt: 'Select a medicine' },
          { required: true, class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" } %>
      <p class="text-sm text-gray-500">Select a medicine from the list</p>
    </div>

    <div class="space-y-2">
      <%= form.label :notes, "Notes", class: "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" %>
      <%= form.text_area :notes,
          rows: 3,
          placeholder: "Optional notes about this medicine (e.g., take with food, avoid certain activities)",
          class: "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
      <p class="text-sm text-gray-500">Add any special instructions or notes</p>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div class="space-y-2">
        <%= form.label :max_daily_doses, "Max daily doses", class: "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" %>
        <%= form.number_field :max_daily_doses,
            min: 1,
            placeholder: 'Optional',
            class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
        <p class="text-sm text-gray-500">Maximum doses per day</p>
      </div>

      <div class="space-y-2">
        <%= form.label :min_hours_between_doses, "Min hours between doses", class: "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" %>
        <%= form.number_field :min_hours_between_doses,
            min: 1,
            step: 0.5,
            placeholder: 'Optional',
            class: "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" %>
        <p class="text-sm text-gray-500">Minimum time between doses</p>
      </div>
    </div>

    <div class="flex justify-end space-x-2 pt-4">
      <% if inline %>
        <button type="button" onclick="this.closest('[data-turbo-frame]').remove()" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
          Cancel
        </button>
      <% else %>
        <%= link_to "Cancel", person_path(person), class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2" %>
      <% end %>
      <%= form.submit "Add Medicine", class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" %>
    </div>
  </div>
<% end %>
