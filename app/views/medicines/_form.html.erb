<%= form_with(model: medicine, class: "form", data: { controller: "dosage-options" }) do |f| %>
  <% if medicine.errors.any? %>
    <div class="form__errors">
      <h2><%= pluralize(medicine.errors.count, "error") %> prohibited this medicine from being saved:</h2>
      <ul>
        <% medicine.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form__grid">
    <div class="form__field">
      <%= f.label :name, class: "form__label" %>
      <%= f.text_field :name, class: "form__input" %>
    </div>

    <div class="form__field form__field--full">
      <%= f.label :description, class: "form__label" %>
      <%= f.text_area :description, rows: 3, class: "form__input" %>
    </div>

    <div class="form__field form__field--group">
      <%= f.label :dosage, 'Standard Dosage', class: "form__label" %>
      <div class="form__input-group">
        <%= f.text_field :dosage, class: "form__input form__input--number" %>
        <%= f.select :unit, [
          ['tablet', 'tablet'],
          ['mg', 'mg'],
          ['ml', 'ml'],
          ['g', 'g'],
          ['mcg', 'mcg'],
          ['IU', 'IU'],
          ['spray', 'spray'],
          ['drop', 'drop']
        ], {}, { class: "form__input form__input--select" } %>
      </div>
    </div>

    <div class="form__field form__field--full">
      <div class="form__label-group">
        <label class="form__label">Additional Dosage Options</label>
        <button type="button" class="button button--small" data-action="dosage-options#add">Add Option</button>
      </div>
      
      <div data-dosage-options-target="template" style="display: none;">
        <%= render 'dosage_option_fields', dosage_option: DosageOption.new %>
      </div>

      <div data-dosage-options-target="container">
        <%= f.fields_for :dosage_options do |dosage_form| %>
          <div class="form__input-group form__input-group--with-action" data-dosage-options-target="option">
            <%= dosage_form.text_field :amount, class: "form__input form__input--number" %>
            <button type="button" class="button button--danger button--small" data-action="click->dosage-options#remove">Remove</button>
            <%= dosage_form.hidden_field :_destroy %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="form__field form__field--full">
      <%= f.label :warnings, class: "form__label" %>
      <%= f.text_area :warnings, rows: 3, class: "form__input" %>
    </div>
  </div>

  <div class="form__actions">
    <%= f.submit class: "button button--primary" %>
    <%= link_to "Back", medicines_path, class: "button button--secondary" %>
  </div>
<% end %>
