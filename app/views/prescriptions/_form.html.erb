<%# Usage:
    Inline form (in a modal):
    render "form", prescription: @prescription, inline: true, medicines: @medicines

    Regular form (full page):
    render "form", prescription: @prescription, inline: false, medicines: @medicines

    Required locals:
    - prescription: The prescription instance to build the form for
    - medicines: Collection of available medicines for the select box
    - inline: Boolean indicating if this is an inline form (modal) or full page form
%>

<% inline ||= false %>
<% local = !inline # Use local form submission for non-inline forms %>
<%= form_with(model: [@person, prescription], class: "prescription-form", local: local) do |f| %>
  <% if prescription.errors.any? %>
    <div class="form__errors">
      <h2><%= pluralize(prescription.errors.count, "error") %> prohibited this prescription from being saved:</h2>
      <ul>
        <% prescription.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="prescription-form__grid">
    <div class="prescription-form__field">
      <%= f.label :medicine_id, "Medicine", class: "form__label" %>
      <%= f.collection_select :medicine_id, medicines, :id, :name,
          { prompt: "Select a medicine" },
          { class: "form__input" } %>
    </div>

    <div class="prescription-form__field">
      <%= f.label :dosage, class: "form__label" %>
      <%= f.text_field :dosage, class: "form__input" %>
    </div>

    <div class="prescription-form__field">
      <%= f.label :frequency, class: "form__label" %>
      <%= f.text_field :frequency, class: "form__input" %>
    </div>

    <div class="prescription-form__field">
      <%= f.label :start_date, "Start date", class: "form__label" %>
      <%= f.date_field :start_date, class: "form__input" %>
    </div>

    <div class="prescription-form__field">
      <%= f.label :end_date, "End date", class: "form__label" %>
      <%= f.date_field :end_date, class: "form__input" %>
    </div>

    <div class="prescription-form__field prescription-form__field--full">
      <%= f.label :notes, class: "form__label" %>
      <%= f.text_area :notes, rows: 3, class: "form__input" %>
    </div>
  </div>

  <div class="form__actions">
    <% if inline %>
      <%= f.submit prescription.new_record? ? "Add Prescription" : "Update Prescription", 
          class: "button button--primary", 
          data: { "prescription-form-target": "submit" } %>
      <%= link_to "Cancel", "#", 
          class: "button button--secondary",
          data: { action: "click->prescription-form#cancel" } %>
    <% else %>
      <%= f.submit prescription.new_record? ? "Add Prescription" : "Update Prescription", 
          class: "button button--primary" %>
      <%= link_to "Cancel", person_path(@person), 
          class: "button button--secondary" %>
    <% end %>
  </div>
<% end %>
