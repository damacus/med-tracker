#!/bin/bash -e

# Local test environment setup
# Prepares SQLite3 database and runs tests

echo "Installing gems..."
bundle install

# Prepare test database only if needed
if ! bundle exec rails runner -e test "ActiveRecord::Base.connection.table_exists?('schema_migrations')" 2>/dev/null; then
  echo "Preparing test database..."
  bundle exec rails db:test:prepare
else
  echo "Test database already prepared."
fi

# Execute the command passed to the script, or run all specs by default
if [ $# -eq 0 ]; then
  echo "Running all specs..."
  bundle exec rspec
else
  echo "Running: $@"
  exec "${@}"
fi
